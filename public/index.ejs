<!DOCTYPE html>

<html>

	<head>
		<title>Nightlife Coordination</title>
		
		<link href="/public/css/clementine.css" rel="stylesheet" type="text/css">
		<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" type="text/css">
		<link href="/public/css/main.css" rel="stylesheet" type="text/css">
	</head>
	
	<%- include header.ejs %>

	<body>
		<div class="container">
			<h1>Plans Tonight?</h1>
			<h2><i class="fa fa-map-marker"></i> <i class="fa fa-cab"></i> <i class="fa fa-glass"></i></h2>
			<h3>See which bars are popular tonight and RSVP ahead of time!</h3>
		</div>
		
		<div class="container">
			<% if (user) { %>
				<input type="text" placeholder="Enter Location" value="<%= user.lastQuery %>" id="search-bar">
			<% } else { %>
			    <input type="text" placeholder="Enter Location" value="" id="search-bar">
			<% } %>
			<button id="go-time">Go</button>
		</div>
		
		<div id="results">
			
		</div>
	</body>
	
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script>
	    function updateResults() {
	    	var location = $('#search-bar').val();
	    	
	    	$.ajax({
			    url: "https://nightlife-app-fleemaja.c9users.io/api/" + encodeURI(location),
			    dataType: "json",
			    success: function(json) {
			    	$('#results').empty();
			    	json.forEach(function(bar) {
			    	  var name = bar.name;
			    	  var imgURL = bar.image_url;
			    	  var snippet = bar.snippet;
			    	  var goingNum = bar.attending.length;
			    	  var html = "<div class=\"container\"><img src=\"" + imgURL + "\">";
			    	  html += "<h4>" + name + "</h4>";
			    	  html += "<button>Going: " + goingNum + "</button>";
			    	  html += "<p>" + snippet + "</p></div>";
			    	  $('#results').append(html);
			    	});
			    }
			  });
	    }
	    
	    $('document').ready(function() {
	    	updateResults();
	    });
	    
	    $('#go-time').click(function() {
			updateResults();
	    });
	</script>

</html>